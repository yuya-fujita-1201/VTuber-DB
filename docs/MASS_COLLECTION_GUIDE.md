# 大規模収集機能 実装ガイド

**プロジェクト名**: VTuber-DB 大規模データ収集機能  
**実施日**: 2026-01-03  
**目標**: 50件 → 1000〜2000件にデータを拡張

---

## 🎯 実装完了

VTuber-DBのデータを1000〜2000件に拡張するための「大規模収集機能」を実装しました。

### 主要機能

✅ **YouTube検索ベースの自動収集**
- 30種類のVTuber関連キーワードで自動検索
- 各キーワードから最大50件取得
- 重複を自動スキップ
- レート制限対策（1秒待機）

✅ **管理画面の大規模収集ボタン**
- 目標収集数を指定（100〜2000件）
- ワンクリックで実行
- リアルタイム進捗表示

✅ **API エンドポイント**
- `POST /api/admin/mass-collect`
- 認証機能付き
- エラーハンドリング

---

## 📋 使い方

### ステップ1: 管理画面にアクセス

1. `https://vtuber-db.pages.dev/admin/data-collection` にアクセス
2. 管理者パスワードでログイン

### ステップ2: 大規模収集を実行

画面上部に「🚀 大規模収集（YouTube検索ベース）」セクションがあります。

**操作方法**:
1. **目標収集数を入力**: 100〜2000件（推奨: 1000件）
2. **「〇〇件の大規模収集を実行」ボタンをクリック**
3. 数分待つ（1000件で約10〜20分）

**注意事項**:
- YouTube APIのクォータを消費します
- 既存のチャンネルIDは自動的にスキップされます
- 実行中はブラウザを閉じないでください

### ステップ3: 結果を確認

収集完了後、以下のメッセージが表示されます：

```
✅ 1000件のVTuberを収集しました（30キーワード使用）
```

統計情報も自動的に更新されます。

---

## 🔍 検索キーワード（30種類）

### 一般キーワード（3種類）
- VTuber
- バーチャルYouTuber
- 個人勢VTuber

### 事務所キーワード（14種類）
- ホロライブ
- にじさんじ
- ぶいすぽ
- あおぎり高校
- 774inc
- Re:AcT
- Neo-Porte
- VOMS
- VShojo
- .LIVE
- ななしいんく
- のりプロ
- すぺしゃりて
- GEMS COMPANY
- Palette Project
- Balus VTuber
- bondlive
- Million Production VTuber
- Varium
- VEE VTuber

### ジャンルキーワード（5種類）
- VTuber 歌ってみた
- VTuber ゲーム実況
- VTuber APEX
- VTuber マイクラ
- VTuber 雑談

---

## 📊 収集フロー

```
1. 管理画面で「大規模収集を実行」ボタンをクリック
   ↓
2. 30種類のキーワードでYouTubeを検索
   ↓
3. 各キーワードから最大50件のチャンネルを取得
   ↓
4. 既存のチャンネルIDをスキップ（重複防止）
   ↓
5. チャンネル情報を一括取得（YouTube API）
   ↓
6. VTuberとYouTubeチャンネル情報をDBに保存
   ↓
7. initial_sync_channelジョブをenqueue
   ↓
8. 目標件数に達するまで繰り返し
   ↓
9. 完了メッセージを表示
```

---

## ⚙️ 技術仕様

### YouTube API使用量

**1回の検索**:
- `search` API: 100クォータ
- `channels` API（一括取得）: 1クォータ

**1000件収集の場合**:
- 約30回の検索（30キーワード）: 3,000クォータ
- 約20回の一括取得（50件ずつ）: 20クォータ
- **合計**: 約3,020クォータ

**1日のクォータ制限**: 10,000クォータ

→ **1日あたり最大3回**（3000件）実行可能

### レート制限対策

- 各検索の間に1秒待機
- 一括取得は50件ずつ
- エラー時は自動スキップ

### データ品質

収集されるVTuberの種類:
- 大手事務所所属（ホロライブ、にじさんじなど）
- 中小事務所所属（ぶいすぽ、774incなど）
- 個人勢VTuber
- 新人VTuber

登録者数の範囲:
- 最小: 数百人
- 最大: 数百万人

---

## 🚀 推奨の使い方

### 初回実行

1. **目標: 1000件**
2. 実行時間: 約10〜20分
3. 実行タイミング: 深夜や早朝（APIクォータに余裕がある時間帯）

### 2回目以降

1. **目標: 500件ずつ**
2. 実行間隔: 1日おき
3. 最終目標: 2000件

### データ整備

収集後、以下を実行してください：

1. **AIタグ付け**: 100件ずつ実行
2. **ジョブ監視**: `/admin/jobs`で確認
3. **データ確認**: VTuberが正しく追加されているか確認

---

## 📈 期待される結果

### データ量

| 実行回数 | 目標件数 | 累計件数 |
|---|---|---|
| 初回 | 1000件 | 1050件 |
| 2回目 | 500件 | 1550件 |
| 3回目 | 500件 | 2050件 |

### データの内訳（推定）

| カテゴリ | 割合 | 件数（2000件中） |
|---|---|---|
| 大手事務所 | 20% | 400件 |
| 中小事務所 | 30% | 600件 |
| 個人勢 | 50% | 1000件 |

---

## ⚠️ 注意事項

### YouTube APIクォータ

- **1日10,000クォータ**が上限
- 大規模収集は**1日最大3回**まで
- クォータ超過時はエラーが発生します

### 実行時間

- 1000件で約10〜20分
- ブラウザを閉じないでください
- ネットワークが不安定な場合は失敗する可能性があります

### データ品質

- YouTube検索結果に依存するため、VTuberでないチャンネルが含まれる可能性があります
- 収集後、手動で確認することを推奨します

---

## 🛠️ トラブルシューティング

### エラー: YouTube API error: 403

**原因**: APIクォータ超過

**解決策**:
1. 翌日まで待つ
2. Google Cloud Consoleでクォータ使用量を確認

### エラー: 大規模収集に失敗しました

**原因**: ネットワークエラー、またはAPIキーが無効

**解決策**:
1. ネットワーク接続を確認
2. `YOUTUBE_API_KEY`が正しく設定されているか確認
3. 再実行

### 収集件数が目標に達しない

**原因**: 既存のチャンネルIDが多い、または検索結果が少ない

**解決策**:
1. 目標件数を増やす（例: 1000 → 1500）
2. 再実行

---

## 📝 実装ファイル

| ファイル | 説明 |
|---|---|
| `src/scripts/mass-collect-vtubers.js` | 大規模収集スクリプト |
| `src/routes/admin-batch.js` | バッチ収集APIエンドポイント |
| `frontend/src/pages/admin/DataCollection.jsx` | 管理画面（データ収集ページ） |

---

## 🎉 まとめ

大規模収集機能により、VTuber-DBのデータを**50件から2000件**に拡張できるようになりました。

**次のステップ**:
1. 管理画面で大規模収集を実行（1000件）
2. AIタグ付けを実行（100件ずつ）
3. データを確認
4. 必要に応じて追加収集（500件ずつ）

これで、VTuber-DBは「探索型VTuber発見エンジン」として、より多くのVTuberを発見できるようになります！🚀

---

**報告書作成日**: 2026-01-03  
**作成者**: Manus AI
