# Phase 4å®Œäº†å ±å‘Š: ç©ºãƒ†ãƒ¼ãƒ–ãƒ«ã®å……å¡«æ©Ÿèƒ½

## ğŸ“‹ æ¦‚è¦

Phase 4ã§ã¯ã€youtube_contentsã€tag_relationsã€vtuber_tag_evidenceãªã©ã®ç©ºãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’å……å¡«ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

---

## âœ… å®Ÿè£…ã—ãŸæ©Ÿèƒ½

### 1. å‹•ç”»ãƒ‡ãƒ¼ã‚¿åé›† (`fillYouTubeContents`)

**æ©Ÿèƒ½**:
- `youtube_contents`ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç©ºã®VTuberã®å‹•ç”»ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
- 1VTuberã‚ãŸã‚Š5æœ¬ã®å‹•ç”»ã‚’å–å¾—ï¼ˆæœ€æ–°é †ï¼‰
- å‹•ç”»ã®è©³ç´°æƒ…å ±ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜ã€å†ç”Ÿå›æ•°ã€ã„ã„ã­æ•°ãªã©ï¼‰ã‚’ä¿å­˜

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```
POST /api/admin/fill-contents
body: { limit: 10, videosPerChannel: 5 }
```

**æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ**:
- 50VTuber Ã— 5æœ¬ = 250æœ¬ã®å‹•ç”»ãƒ‡ãƒ¼ã‚¿
- ã‚¿ã‚°æ ¹æ‹ ã®ç”Ÿæˆã«ä½¿ç”¨

---

### 2. ã‚¿ã‚°é–¢é€£åº¦è¨ˆç®— (`calculateTagRelations`)

**æ©Ÿèƒ½**:
- `tag_relations`ãƒ†ãƒ¼ãƒ–ãƒ«ã«å…±èµ·ã‚¿ã‚°ã¨å…„å¼Ÿã‚¿ã‚°ã‚’è¨ˆç®—
- **å…±èµ·ã‚¿ã‚°**: åŒã˜VTuberã«ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã‚¿ã‚°ã®ãƒšã‚¢
- **å…„å¼Ÿã‚¿ã‚°**: åŒã˜è¦ªã‚’æŒã¤ã‚¿ã‚°

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```
POST /api/admin/calculate-relations
body: { minCooccurrence: 3 }
```

**æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ**:
- ç´„100ã€œ200ä»¶ã®ã‚¿ã‚°é–¢é€£åº¦
- ã€Œæ¬¡ã«è¾¿ã‚‹å€™è£œã‚¿ã‚°ã€ã®ææ¡ˆã«ä½¿ç”¨

---

### 3. ã‚¿ã‚°æ ¹æ‹ ç”Ÿæˆ (`generateTagEvidence`)

**æ©Ÿèƒ½**:
- `vtuber_tag_evidence`ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¿ã‚°ã®æ ¹æ‹ ã‚’ç”Ÿæˆ
- å‹•ç”»ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¿ã‚°ã«é–¢é€£ã™ã‚‹å‹•ç”»ã‚’æ¤œç´¢
- å‹•ç”»ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ ¹æ‹ ã‚’ç”Ÿæˆ

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```
POST /api/admin/generate-evidence
body: { limit: 50 }
```

**æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ**:
- ç´„150ã€œ200ä»¶ã®ã‚¿ã‚°æ ¹æ‹ 
- VTuberè©³ç´°ãƒšãƒ¼ã‚¸ã§ã‚¿ã‚°ã®æ ¹æ‹ ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

### 4. ç®¡ç†ç”»é¢ (`/admin/maintenance`)

**æ©Ÿèƒ½**:
- å‹•ç”»ãƒ‡ãƒ¼ã‚¿åé›†ã€ã‚¿ã‚°é–¢é€£åº¦è¨ˆç®—ã€ã‚¿ã‚°æ ¹æ‹ ç”Ÿæˆã‚’å€‹åˆ¥å®Ÿè¡Œ
- ä¸€æ‹¬ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Ÿè¡Œãƒœã‚¿ãƒ³ï¼ˆ3ã¤ã®å‡¦ç†ã‚’ä¸€æ‹¬å®Ÿè¡Œï¼‰
- çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤ºï¼ˆå‹•ç”»æ•°ã€é–¢é€£åº¦æ•°ã€æ ¹æ‹ æ•°ï¼‰

**ãƒ‘ã‚¹**:
```
https://vtuber-db.pages.dev/admin/maintenance
```

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹çµæœ

### åˆå›å®Ÿè¡Œæ™‚ï¼ˆ50VTuberï¼‰

| ãƒ†ãƒ¼ãƒ–ãƒ« | ç¾çŠ¶ | å®Ÿè¡Œå¾Œ |
|---|---|---|
| youtube_contents | 0æœ¬ | 250æœ¬ |
| tag_relations | 0ä»¶ | 100ã€œ200ä»¶ |
| vtuber_tag_evidence | 0ä»¶ | 150ã€œ200ä»¶ |

### ãƒ‡ãƒ¼ã‚¿æ‹¡å……å¾Œï¼ˆ500VTuberï¼‰

| ãƒ†ãƒ¼ãƒ–ãƒ« | ç¾çŠ¶ | å®Ÿè¡Œå¾Œ |
|---|---|---|
| youtube_contents | 250æœ¬ | 2,500æœ¬ |
| tag_relations | 100ã€œ200ä»¶ | 500ã€œ1,000ä»¶ |
| vtuber_tag_evidence | 150ã€œ200ä»¶ | 1,500ã€œ2,000ä»¶ |

---

## ğŸš€ ä½¿ã„æ–¹

### ã‚¹ãƒ†ãƒƒãƒ—1: ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹

```
https://vtuber-db.pages.dev/admin/maintenance
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ä¸€æ‹¬ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®Ÿè¡Œ

1. ã€Œä¸€æ‹¬ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. æ•°åˆ†å¾…ã¤ï¼ˆ50VTuberã®å ´åˆã€ç´„3ã€œ5åˆ†ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—3: çµæœã‚’ç¢ºèª

- çµ±è¨ˆæƒ…å ±ãŒæ›´æ–°ã•ã‚Œã‚‹
- VTuberè©³ç´°ãƒšãƒ¼ã‚¸ã§ã‚¿ã‚°ã®æ ¹æ‹ ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- æ¤œç´¢ãƒšãƒ¼ã‚¸ã§ã€Œæ¬¡ã«è¾¿ã‚‹å€™è£œã‚¿ã‚°ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

## ğŸ”§ æŠ€è¡“çš„ãªè©³ç´°

### YouTubeService.getChannelVideos()

**å®Ÿè£…å†…å®¹**:
- YouTube Data API v3ã‚’ä½¿ç”¨
- 2æ®µéšã®APIå‘¼ã³å‡ºã—ï¼ˆsearch â†’ videosï¼‰
- å‹•ç”»ã®è©³ç´°æƒ…å ±ã‚’å–å¾—ï¼ˆå†ç”Ÿå›æ•°ã€ã„ã„ã­æ•°ã€ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã€å‹•ç”»æ™‚é–“ï¼‰

**APIã‚¯ã‚©ãƒ¼ã‚¿**:
- 1VTuberã‚ãŸã‚Šç´„3ã‚¯ã‚©ãƒ¼ã‚¿
- 10VTuberã§ç´„30ã‚¯ã‚©ãƒ¼ã‚¿

### ã‚¿ã‚°é–¢é€£åº¦ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

**å…±èµ·ã‚¿ã‚°**:
```sql
SELECT 
  vt1.tag_id,
  vt2.tag_id AS related_tag_id,
  COUNT(*) / (SELECT COUNT(DISTINCT vtuber_id) FROM vtuber_tags WHERE tag_id = vt1.tag_id) AS weight
FROM vtuber_tags vt1
JOIN vtuber_tags vt2 ON vt1.vtuber_id = vt2.vtuber_id AND vt1.tag_id < vt2.tag_id
GROUP BY vt1.tag_id, vt2.tag_id
HAVING COUNT(*) >= 3
```

**å…„å¼Ÿã‚¿ã‚°**:
```sql
SELECT 
  t1.id AS tag_id,
  t2.id AS related_tag_id,
  0.7 AS weight
FROM tags t1
JOIN tags t2 ON t1.parent_id = t2.parent_id AND t1.id < t2.id
WHERE t1.parent_id IS NOT NULL
```

---

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### Phase 5: å®šæœŸè‡ªå‹•å®Ÿè¡Œã®å®Ÿè£…

**Kamui-4Dã«ä¾é ¼**:
- ã‚¿ã‚¹ã‚¯F: è‡ªå‹•å®Ÿè¡Œã‚¸ãƒ§ãƒ–ã®ä½œæˆï¼ˆ3æ™‚é–“ï¼‰
  - `src/cron/weekly-collect.js`: æ¯é€±æ—¥æ›œæ—¥ã«æ–°è¦VTuber100ä»¶åé›†
  - `src/cron/daily-update.js`: æ¯æ—¥æ—¢å­˜VTuberã®ãƒ‡ãƒ¼ã‚¿æ›´æ–°
  - `src/cron/daily-maintenance.js`: æ¯æ—¥ç©ºãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åŸ‹ã‚ã‚‹

**ManusãŒå¾…æ©Ÿ**:
- Phase 5-1: Cron Triggerã®è¨­å®šï¼ˆ1æ™‚é–“ï¼‰

---

## ğŸ¯ å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯

- âœ… Phase 1: ç¾çŠ¶åˆ†æã¨æ®µéšçš„ã‚¿ã‚¹ã‚¯ã®ç­–å®š
- âœ… Phase 2: é‡è¤‡æ’é™¤ã¨æ–°è¦ç™ºè¦‹ã®æ”¹å–„
- âœ… Phase 4: ç©ºãƒ†ãƒ¼ãƒ–ãƒ«ã®å……å¡«ï¼ˆã‚¿ã‚°ãƒ»å‹•ç”»ãƒ»é–¢é€£åº¦ï¼‰

**é€²è¡Œä¸­**:
- â³ Phase 3: å…¨ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ»å…¨ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆKamui-4D ã‚¿ã‚¹ã‚¯Eï¼‰

**æ¬¡**:
- ğŸ”œ Phase 5: å®šæœŸè‡ªå‹•å®Ÿè¡Œã®å®Ÿè£…ï¼ˆKamui-4D ã‚¿ã‚¹ã‚¯Fï¼‰
