# Phase 3-2: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ãƒãƒƒãƒåé›† å®Œäº†å ±å‘Š

## ğŸ“‹ æ¦‚è¦

**å®Ÿæ–½æ—¥**: 2026-01-04

**ç›®çš„**: Kamui-4DãŒä½œæˆã—ãŸãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆï¼ˆ484äººï¼‰ã‚’ä½¿ã£ã¦ã€VTuberãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬åé›†ã™ã‚‹

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **æº–å‚™å®Œäº†**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å®Ÿè¡Œå¾…ã¡ï¼‰

---

## âœ… å®Œäº†ã—ãŸä½œæ¥­

### 1. channel_idsã®æŠ½å‡º

**ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `src/scripts/batch-collect-agencies.js`

**å…¥åŠ›**: `data/vtuber_agencies_full.json`ï¼ˆKamui-4Dä½œæˆï¼‰

**å‡ºåŠ›**: `data/agency_channel_ids.json`

**çµ±è¨ˆ**:
- **ç·VTuberæ•°: 484äºº**
- **äº‹å‹™æ‰€æ•°: 10äº‹å‹™æ‰€**

**äº‹å‹™æ‰€åˆ¥å†…è¨³**:
| äº‹å‹™æ‰€ | VTuberæ•° |
|--------|---------|
| ãƒ›ãƒ­ãƒ©ã‚¤ãƒ– | 94äºº |
| ã«ã˜ã•ã‚“ã˜ | 188äºº |
| ã¶ã„ã™ã½ã£! | 18äºº |
| Re:AcT | 21äºº |
| Neo-Porte | 8äºº |
| .LIVE | 16äºº |
| PRISM Project | 17äºº |
| Phase-Connect | 23äºº |
| ãªãªã—ã„ã‚“ã | 18äºº |
| VShojo | 26äºº |
| **åˆè¨ˆ** | **484äºº** |

---

### 2. ä¸€æ‹¬è¿½åŠ APIã®ç¢ºèª

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/admin/bulk-import/channels`

**æ©Ÿèƒ½**:
- channel_idsã®é…åˆ—ã‚’å—ã‘å–ã‚‹
- æ—¢å­˜ã®channel_idã‚’è‡ªå‹•çš„ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- YouTube APIã§ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’å–å¾—ï¼ˆãƒãƒƒãƒã‚µã‚¤ã‚º: 50ä»¶ï¼‰
- DBã«æŒ¿å…¥ï¼ˆvtubers + youtube_channelsï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**å®Ÿè£…çŠ¶æ³**: âœ… **å®Œäº†**ï¼ˆ`src/routes/admin-bulk-import.js`ï¼‰

---

### 3. ãƒ‡ãƒ¼ã‚¿åé›†ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

**ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `src/scripts/collect-by-channel-ids.js`

**æ©Ÿèƒ½**:
- `agency_channel_ids.json`ã‚’èª­ã¿è¾¼ã‚€
- æ—¢å­˜ã®channel_idã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- YouTube APIã§ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’å–å¾—
- DBã«æŒ¿å…¥

**å®Ÿè£…çŠ¶æ³**: âœ… **å®Œäº†**

**æ³¨æ„**: ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œç”¨ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ç®¡ç†ç”»é¢ã®APIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹çµæœ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±è¨ˆï¼ˆåé›†å¾Œï¼‰

| é …ç›® | ç¾åœ¨ | åé›†å¾Œ | å¢—åŠ  |
|------|------|--------|------|
| VTuberæ•° | 53 | **537+** | +484 |
| äº‹å‹™æ‰€æ•° | 2 | **12+** | +10 |
| ã‚¿ã‚°æ•° | 60 | 60 | 0 |

### API Quotaä½¿ç”¨é‡

**YouTube API Quota**:
- ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±å–å¾—: 484äºº Ã· 50ä»¶/ãƒªã‚¯ã‚¨ã‚¹ãƒˆ = **10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
- 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ = 1 quota
- **åˆè¨ˆ: 10 quota**

**éå¸¸ã«åŠ¹ç‡çš„**: ãƒãƒƒãƒå‡¦ç†ã«ã‚ˆã‚Šã€API quotaã‚’æœ€å°é™ã«æŠ‘ãˆã¦ã„ã¾ã™ã€‚

---

## ğŸš€ ãƒ¦ãƒ¼ã‚¶ãƒ¼å®Ÿè¡Œæ‰‹é †

### æ–¹æ³•1: ç®¡ç†ç”»é¢ã‹ã‚‰å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰

1. **ç®¡ç†ç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³**
   - URL: https://vtuber-db.pages.dev/admin
   - Admin Token: `ADMIN_TOKEN`ç’°å¢ƒå¤‰æ•°ã®å€¤

2. **ä¸€æ‹¬è¿½åŠ APIã‚’å®Ÿè¡Œ**
   
   ä»¥ä¸‹ã®curlã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼š

   ```bash
   curl -X POST https://vtuber-db.sam-y-1201.workers.dev/api/admin/bulk-import/channels \
     -H "X-Admin-Token: YOUR_ADMIN_TOKEN" \
     -H "Content-Type: application/json" \
     -d @data/agency_channel_ids.json
   ```

   ã¾ãŸã¯ã€JavaScriptã§å®Ÿè¡Œï¼š

   ```javascript
   const channelIds = require('./data/agency_channel_ids.json').channel_ids;
   
   const response = await fetch('https://vtuber-db.sam-y-1201.workers.dev/api/admin/bulk-import/channels', {
     method: 'POST',
     headers: {
       'X-Admin-Token': 'YOUR_ADMIN_TOKEN',
       'Content-Type': 'application/json',
     },
     body: JSON.stringify({
       channel_ids: channelIds,
       source: 'vtuber_agencies_full',
     }),
   });
   
   const result = await response.json();
   console.log(result);
   ```

3. **ç©ºãƒ†ãƒ¼ãƒ–ãƒ«å……å¡«ã‚’å®Ÿè¡Œ**
   
   ç®¡ç†ç”»é¢ã®ã€Œãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ãƒšãƒ¼ã‚¸ã‹ã‚‰ï¼š
   - ã€Œå‹•ç”»ãƒ‡ãƒ¼ã‚¿åé›†ã€ã‚’å®Ÿè¡Œ
   - ã€Œã‚¿ã‚°é–¢é€£åº¦è¨ˆç®—ã€ã‚’å®Ÿè¡Œ
   - ã€Œã‚¿ã‚°æ ¹æ‹ ç”Ÿæˆã€ã‚’å®Ÿè¡Œ

---

### æ–¹æ³•2: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰å®Ÿè¡Œ

**å‰ææ¡ä»¶**:
- `YOUTUBE_API_KEY`ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- `CLOUDFLARE_D1_TOKEN`ã€`CLOUDFLARE_ACCOUNT_ID`ã€`CLOUDFLARE_DATABASE_ID`ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**:

```bash
cd /home/ubuntu/VTuber-DB
node src/scripts/collect-by-channel-ids.js
```

**æ³¨æ„**: ã“ã®æ–¹æ³•ã¯ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œç”¨ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ç®¡ç†ç”»é¢ã®APIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

---

## ğŸ“ æˆæœç‰©

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

- `src/scripts/batch-collect-agencies.js`: channel_idsæŠ½å‡ºã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `src/scripts/collect-by-channel-ids.js`: ãƒ‡ãƒ¼ã‚¿åé›†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«

- `data/agency_channel_ids.json`: 484äººã®channel_idsï¼ˆäº‹å‹™æ‰€åˆ¥ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜ãï¼‰

### API

- `src/routes/admin-bulk-import.js`: ä¸€æ‹¬è¿½åŠ API

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/PHASE3-2_REPORT.md`: Phase 3-2å®Œäº†å ±å‘Šï¼ˆæœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
- `docs/PHASE3-2_USER_GUIDE.md`: ãƒ¦ãƒ¼ã‚¶ãƒ¼å®Ÿè¡Œæ‰‹é †æ›¸ï¼ˆæ¬¡ã«ä½œæˆï¼‰

---

## ğŸ”§ æŠ€è¡“çš„ãªè©³ç´°

### channel_idsæŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯

```javascript
for (const agency of agenciesData.agencies) {
  // divisionsãŒãªã„å ´åˆã¯ã€channelsã‚’ç›´æ¥å‡¦ç†
  if (!agency.divisions && agency.channels) {
    for (const channel of agency.channels) {
      channelIds.push(channel.channel_id);
      channelMap.set(channel.channel_id, {
        name: channel.name,
        agency: agency.name,
        agency_en: agency.name_en,
        division: null,
        division_en: null,
      });
    }
    continue;
  }
  
  // divisionsãŒã‚ã‚‹å ´åˆ
  for (const division of agency.divisions || []) {
    for (const channel of division.channels) {
      channelIds.push(channel.channel_id);
      channelMap.set(channel.channel_id, {
        name: channel.name,
        agency: agency.name,
        agency_en: agency.name_en,
        division: division.name,
        division_en: division.name_en,
      });
    }
  }
}
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `divisions`ãŒãªã„äº‹å‹™æ‰€ï¼ˆã¶ã„ã™ã½ã£!ã€Re:AcTç­‰ï¼‰ã«å¯¾å¿œ
- `divisions`ãŒã‚ã‚‹äº‹å‹™æ‰€ï¼ˆãƒ›ãƒ­ãƒ©ã‚¤ãƒ–ã€ã«ã˜ã•ã‚“ã˜ï¼‰ã«å¯¾å¿œ
- äº‹å‹™æ‰€ãƒ»éƒ¨é–€ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ

---

### ä¸€æ‹¬è¿½åŠ APIã®ãƒ•ãƒ­ãƒ¼

```
1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡ï¼ˆchannel_idsé…åˆ—ï¼‰
   â†“
2. æ—¢å­˜ã®channel_idã‚’å–å¾—
   â†“
3. æ–°è¦channel_idã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
   â†“
4. ãƒãƒƒãƒå‡¦ç†ï¼ˆ50ä»¶ãšã¤ï¼‰
   â†“
5. YouTube APIã§ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’å–å¾—
   â†“
6. DBã«æŒ¿å…¥ï¼ˆvtubers + youtube_channelsï¼‰
   â†“
7. ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´ï¼ˆimported, errors, existingï¼‰
```

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:
- YouTube API ã‚¨ãƒ©ãƒ¼: ãƒãƒƒãƒå…¨ä½“ã‚’ã‚¹ã‚­ãƒƒãƒ—
- DBæŒ¿å…¥ã‚¨ãƒ©ãƒ¼: å€‹åˆ¥ã«ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ç¶šè¡Œ
- ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒ­ã‚°ã«è¨˜éŒ²

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹äºˆæ¸¬

### API Quotaä½¿ç”¨é‡

- ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±å–å¾—: 484äºº Ã· 50ä»¶/ãƒªã‚¯ã‚¨ã‚¹ãƒˆ = **10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
- 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ = 1 quota
- **åˆè¨ˆ: 10 quota**

### å®Ÿè¡Œæ™‚é–“

- YouTube API: 10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ Ã— 1ç§’/ãƒªã‚¯ã‚¨ã‚¹ãƒˆ = **10ç§’**
- DBæŒ¿å…¥: 484ä»¶ Ã— 0.1ç§’/ä»¶ = **48ç§’**
- **åˆè¨ˆ: ç´„1åˆ†**

### ã‚¨ãƒ©ãƒ¼ç‡

- æœŸå¾…ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ç‡: **< 1%**
- ä¸»ãªã‚¨ãƒ©ãƒ¼åŸå› : å‰Šé™¤ã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«ã€éå…¬é–‹ãƒãƒ£ãƒ³ãƒãƒ«

---

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### Phase 5-1: Cron Triggerè¨­å®š

**å‰ææ¡ä»¶**: âœ… Phase 3-2å®Œäº†ï¼ˆVTuberãƒ‡ãƒ¼ã‚¿åé›†ï¼‰

**å®Ÿæ–½å†…å®¹**:
1. `wrangler.toml`ã«Cron Triggerã‚’è¨­å®š
2. `src/scheduled.js`ã‚’å®Ÿè£…
3. å®šæœŸè‡ªå‹•å®Ÿè¡Œã‚’æœ‰åŠ¹åŒ–
4. å‹•ä½œç¢ºèªã¨ãƒ­ã‚°ç›£è¦–

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
- é€±æ¬¡: æ–°è¦VTuberè‡ªå‹•ç™ºè¦‹
- æ—¥æ¬¡: Tier S/Aã®è‡ªå‹•æ›´æ–°
- æ—¥æ¬¡: stale_levelè‡ªå‹•å†è¨ˆç®—

---

## ğŸ“Œ é‡è¦ãªæ³¨æ„äº‹é …

### 1. API Quotaç®¡ç†

- YouTube API quotaã¯1æ—¥10,000ã¾ã§
- ä¸€æ‹¬è¿½åŠ : 10 quota
- å‹•ç”»ãƒ‡ãƒ¼ã‚¿åé›†: 484äºº Ã— 1 quota = 484 quota
- **åˆè¨ˆ: 494 quota**ï¼ˆ1æ—¥ã®åˆ¶é™å†…ï¼‰

### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- YouTube APIã‚¨ãƒ©ãƒ¼: è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãªã—ï¼ˆæ‰‹å‹•å†å®Ÿè¡Œï¼‰
- DBæŒ¿å…¥ã‚¨ãƒ©ãƒ¼: å€‹åˆ¥ã«ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ç¶šè¡Œ
- ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒ­ã‚°ã«è¨˜éŒ²

### 3. ãƒ‡ãƒ¼ã‚¿å“è³ª

- ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã¯æœ€æ–°ã®ã‚‚ã®ã‚’å–å¾—
- å‰Šé™¤ã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«ã¯è‡ªå‹•çš„ã«ã‚¹ã‚­ãƒƒãƒ—
- éå…¬é–‹ãƒãƒ£ãƒ³ãƒãƒ«ã¯å–å¾—ã§ããªã„

---

## ğŸ‰ çµè«–

Phase 3-2ã®æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

**æº–å‚™å®Œäº†**:
- âœ… 484äººã®channel_idsæŠ½å‡º
- âœ… ä¸€æ‹¬è¿½åŠ APIå®Ÿè£…
- âœ… ãƒ‡ãƒ¼ã‚¿åé›†ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼å®Ÿè¡Œæ‰‹é †æ›¸ä½œæˆ

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç®¡ç†ç”»é¢ã‹ã‚‰ä¸€æ‹¬è¿½åŠ ã‚’å®Ÿè¡Œ
2. ç©ºãƒ†ãƒ¼ãƒ–ãƒ«å……å¡«ã‚’å®Ÿè¡Œ
3. Phase 5-1ï¼ˆCron Triggerè¨­å®šï¼‰ã«é€²ã‚€

---

**ä½œæˆè€…**: Manus AI

**ä½œæˆæ—¥**: 2026-01-04

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **æº–å‚™å®Œäº†**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å®Ÿè¡Œå¾…ã¡ï¼‰
